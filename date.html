document.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(window.location.search);
  const date = params.get("date");
  document.getElementById("dateLabel").textContent = date || "Unknown Date";

  const tradeTable = document.querySelector("#tradeTable tbody");
  const addTradeBtn = document.getElementById("addTrade");

  addTradeBtn.addEventListener("click", () => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td><input type="text" placeholder="e.g. EUR/USD"></td>
      <td><input type="number" step="0.01"></td>
      <td><input type="number" step="0.01"></td>
      <td><input type="number" step="0.1"></td>
      <td><input type="number" step="0.01"></td>
      <td><textarea placeholder="Notes..."></textarea></td>
      <td><input type="file" accept="image/*" class="screenshot-input"></td>
      <td><button class="removeRow">ğŸ—‘ï¸</button></td>
    `;
    tradeTable.appendChild(row);
  });

  tradeTable.addEventListener("click", (e) => {
    if (e.target.classList.contains("removeRow")) {
      e.target.closest("tr").remove();
      updateSummary();
    }
  });

  // Screenshot enlarge
  const modal = document.getElementById("imageModal");
  const modalImg = document.getElementById("modalImg");
  const closeModal = document.querySelector(".close");

  tradeTable.addEventListener("change", (e) => {
    if (e.target.classList.contains("screenshot-input")) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (evt) {
          const img = document.createElement("img");
          img.src = evt.target.result;
          img.classList.add("screenshot-thumb");
          img.addEventListener("click", () => {
            modal.style.display = "block";
            modalImg.src = evt.target.result;
          });
          e.target.closest("td").appendChild(img);
        };
        reader.readAsDataURL(file);
      }
    }
  });

  closeModal.onclick = () => (modal.style.display = "none");
  modal.onclick = () => (modal.style.display = "none");

  document.getElementById("backBtn").addEventListener("click", () => {
    window.location.href = "index.html";
  });

  // Theme toggle
  document.getElementById("themeToggle").addEventListener("click", () => {
    document.body.classList.toggle("dark");
  });
});
